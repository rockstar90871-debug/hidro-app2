<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>smartgrow</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1b4332">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial,sans-serif;
  background:#0f1f17;
  color:#eaffea;
  text-align:center;
  padding:20px;
  margin:0;
}
h1{margin-top:10px}

.baldes{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:15px;
  max-width:480px;
  margin:auto;
}

.balde{
  padding:15px;
  border-radius:12px;
  cursor:pointer;
  color:white;
  background-size:cover;
  background-position:center;
  position:relative;
  min-height:90px;
}

.balde::after{
  content:"";
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.45);
  border-radius:12px;
}

.balde span{
  position:relative;
  z-index:2;
  font-size:14px;
}

.estado-ok{background:#2d6a4f}
.estado-at{background:#b08900}
.estado-mal{background:#9b2226}

.panel{
  background:#1b4332;
  padding:20px;
  max-width:650px;
  margin:20px auto;
  border-radius:15px;
}

.oculto{display:none}

label{
  display:block;
  margin-top:10px;
  text-align:left;
  font-size:13px;
}

input,select,textarea{
  width:100%;
  padding:7px;
  border-radius:6px;
  border:none;
  margin-top:3px;
}

textarea{resize:vertical}

button{
  margin-top:12px;
  padding:10px;
  width:100%;
  background:#52b788;
  border:none;
  border-radius:8px;
  font-size:15px;
  cursor:pointer;
}

button.borrar{background:#9b2226}

table{
  width:100%;
  margin-top:15px;
  border-collapse:collapse;
  font-size:11px;
}

th,td{
  border:1px solid #40916c;
  padding:4px;
}

img.thumb{
  width:40px;
  border-radius:4px;
}

#mensajeEstado{
  margin-top:12px;
  padding:10px;
  border-radius:8px;
  background:rgba(0,0,0,.3);
  text-align:left;
}
</style>
</head>

<body>

<h1>üå± Sala de Cultivo Inteligente</h1>
<div class="baldes" id="baldes"></div>

<div id="panel" class="panel oculto">
  <h2 id="tituloBalde"></h2>
  <div id="mensajeEstado"></div>

  <label>Gen√©tica</label>
  <input id="genetica">

  <label>Etapa</label>
  <select id="etapa">
    <option>Germinaci√≥n</option>
    <option>Vegetativo</option>
    <option>Floraci√≥n</option>
    <option>Lavado</option>
  </select>

  <label>üì∏ Foto de la planta</label>
  <input type="file" id="fotoBalde" accept="image/*">

  <form id="registroForm">
    <label>Semana</label>
    <input type="number" id="semana" min="1" max="53" required>

    <label>Mes</label>
    <select id="mes">
      <option>Enero</option><option>Febrero</option><option>Marzo</option>
      <option>Abril</option><option>Mayo</option><option>Junio</option>
      <option>Julio</option><option>Agosto</option><option>Septiembre</option>
      <option>Octubre</option><option>Noviembre</option><option>Diciembre</option>
    </select>

    <label>A√±o</label>
    <input type="number" id="anio" value="2026">

    <label>pH</label>
    <input type="number" step="0.1" id="ph">

    <label>EC</label>
    <input type="number" step="0.1" id="ec">

    <label>Grow</label>
    <input type="number" step="0.1" id="grow">

    <label>Micro</label>
    <input type="number" step="0.1" id="micro">

    <label>Bloom</label>
    <input type="number" step="0.1" id="bloom">

    <label>üìù Nota semanal</label>
    <textarea id="nota"></textarea>

    <label>üì∑ Foto semanal</label>
    <input type="file" id="fotoSemana" accept="image/*">

    <button>üíæ Guardar registro semanal</button>
  </form>

  <div id="historial"></div>
  <button class="borrar" id="borrarHistorial">üóëÔ∏è Cerrar ciclo</button>
</div>

<script>
const baldesDiv=document.getElementById("baldes");
let baldeActual=null;

/* ===== UTIL ===== */
function setEstado(actual,nuevo){
  const orden={ok:1,at:2,mal:3};
  return orden[nuevo]>orden[actual]?nuevo:actual;
}

/* ===== EVALUACI√ìN ===== */
function evaluarEstado(ph,ec,g,m,b){
  let estado="ok";
  let mensajes=[];
  ph=parseFloat(ph); ec=parseFloat(ec);

  if(ph>=5.5&&ph<=6.5) mensajes.push("pH √≥ptimo.");
  else if(ph>=3.5&&ph<=5.0){estado=setEstado(estado,"at");mensajes.push("pH bajo.");}
  else if(ph>=6.7&&ph<=8.0){estado=setEstado(estado,"at");mensajes.push("pH alto.");}
  else{estado=setEstado(estado,"mal");mensajes.push("pH cr√≠tico.");}

  if(ec<0.8){estado=setEstado(estado,"mal");mensajes.push("EC muy baja.");}
  else if(ec<1.2){estado=setEstado(estado,"at");mensajes.push("EC baja.");}
  else if(ec>2.5){estado=setEstado(estado,"mal");mensajes.push("EC alta.");}

  const total=(+g||0)+(+m||0)+(+b||0);
  if(total===0){estado=setEstado(estado,"mal");mensajes.push("Sin nutrientes.");}
  if(total>6){estado=setEstado(estado,"mal");mensajes.push("Sobrefertilizaci√≥n.");}

  return{estado,mensajes};
}

/* ===== BALDES ===== */
for(let i=1;i<=9;i++){
  const d=document.createElement("div");
  d.id=`balde${i}`;
  d.className="balde";
  d.onclick=()=>abrirBalde(i);
  baldesDiv.appendChild(d);
  actualizarBalde(i);
}

function actualizarBalde(n){
  const g=localStorage.getItem(`balde${n}_genetica`)||"Sin gen√©tica";
  const e=localStorage.getItem(`balde${n}_estado`)||"ok";
  const f=localStorage.getItem(`balde${n}_foto`);
  const b=document.getElementById(`balde${n}`

