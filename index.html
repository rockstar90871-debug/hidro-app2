registroForm.onsubmit = e => {
  e.preventDefault();

  const evaluacion = evaluarEstado(ph.value, ec.value);

  const data = {
    semana: semana.value,
    ph: ph.value,
    ec: ec.value,
    grow: grow.value,
    micro: micro.value,
    bloom: bloom.value,
    nota: nota.value,
    estado: evaluacion.estado,
    mensajes: evaluacion.mensajes
  };

  if (fotoSemana.files[0]) {
    const r = new FileReader();
    r.onload = () => {
      localStorage.setItem(`balde${baldeActual}_foto_${semana.value}`, r.result);
    };
    r.readAsDataURL(fotoSemana.files[0]);
  }

  localStorage.setItem(
    `balde${baldeActual}_${semana.value}`,
    JSON.stringify(data)
  );

  localStorage.setItem(
    `balde${baldeActual}_estado`,
    evaluacion.estado
  );

  registroForm.reset();
  cargarHistorial();
  actualizarBalde(baldeActual);
};
